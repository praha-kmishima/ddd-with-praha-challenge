# アクティブコンテキスト

## 現在の開発フェーズ

現在、プロジェクトは初期段階にあります。基本的なTODOリスト機能が実装されていますが、プラハチャレンジの仕様に記載されている参加者、チーム、課題の管理機能の実装を進めています。

## 現在の焦点

### 実装済みの機能
- 基本的なタスク管理機能
  - タスクの作成
  - タスクのタイトル編集
  - タスクの完了状態への変更
  - タスクの取得
  - タスクリストの取得
- 値オブジェクトの基盤
  - Result型の実装（成功/失敗を表現する型）
  - EmailAddress値オブジェクトの実装
  - EnrollmentStatus値オブジェクトの実装

### 現在取り組んでいる課題
- 値オブジェクトの実装
  - TeamName値オブジェクトの実装
  - ProgressStatus値オブジェクトの実装
- チーム集約の実装準備

## 最近の変更点

### アーキテクチャの決定
- オニオンアーキテクチャの採用
- 2つの集約（チーム、課題）によるドメインモデルの設計
- ドメインイベントを用いた集約間連携の方針決定
- ドメインサービスを最小限に抑えるアプローチの採用

### 技術スタックの選定
- TypeScriptとNode.jsによる実装
- Honoフレームワークを用いたAPIサーバーの構築
- DrizzleによるPostgreSQLアクセスの実装
- Vitestによるテスト環境の整備

### 実装の進捗
- 値オブジェクトの実装方針の確立
  - 不変性を持つクラスとして実装
  - ファクトリメソッドでバリデーションを行い、Result型で結果を返す
  - 等価性比較のためのequalsメソッドを実装
- EmailAddress値オブジェクトの実装完了
  - バリデーションロジックの実装
  - テストケースの作成と実行
- EnrollmentStatus値オブジェクトの実装完了
  - 在籍状態の値と遷移ルールの管理
  - チーム所属可能性の判定
  - テストケースの作成と実行

## 次のステップ

### 短期的な目標
1. **値オブジェクトの実装**
   - TeamName値オブジェクトの実装
   - ProgressStatus値オブジェクトの実装

2. **チーム集約の実装**
   - TeamMemberエンティティ（子エンティティ）の作成
   - Teamエンティティ（集約ルート）の作成
   - チームリポジトリの実装
   - チーム関連のユースケース実装

3. **ドメインイベント基盤の実装**
   - イベント発行の仕組み構築
   - イベントハンドラーの実装
   - イベント購読の仕組み構築

4. **課題集約の拡張**
   - 現在のタスクモデルを課題モデルに拡張
   - 進捗ステータスの値オブジェクト実装
   - 所有者（TeamMember）との関連付け
   - 進捗ステータス変更ルールの実装

5. **アプリケーション層のポリシー実装**
   - TeamReorganizationPolicyの実装
   - TaskManagementPolicyの実装

### 中期的な目標
1. **最小限のドメインサービスの実装**
   - チーム再編サービスの実装（複雑なアルゴリズムのみ）

2. **複雑なビジネスルールの実装**
   - 参加者の増減に伴うチーム再編ロジック
   - メール通知機能の実装
   - 課題の進捗管理ロジック

3. **クエリ最適化**
   - 読み取り操作のためのクエリサービスの実装
   - パフォーマンス改善

## 現在のアクティブな決定事項

### 設計上の決定
1. **集約の設計方針**
   - チーム集約と課題集約の2つの集約に分割
   - チーム集約内に参加者を子エンティティとして含める
   - 集約間の参照はIDのみを使用

2. **値オブジェクトの実装方針**
   - 不変性を持つクラスとして実装
   - ファクトリメソッドでバリデーションを行い、Result型で結果を返す
   - 等価性比較のためのequalsメソッドを実装
   - 状態遷移ルールを持つ値オブジェクトはcanTransitionToメソッドを実装

3. **リポジトリの実装方針**
   - インターフェースをドメイン層で定義
   - 実装はインフラストラクチャ層で提供
   - トランザクション管理を考慮した設計

4. **ドメインイベントの活用**
   - 集約間の連携にドメインイベントを使用
   - イベント駆動アーキテクチャの採用
   - アプリケーション層のポリシーでイベントを購読

### 技術的な決定
1. **型安全性の確保**
   - Result型を用いたエラーハンドリング
   - Zodによる入力バリデーション

2. **テスト戦略**
   - ドメイン層は単体テストで高いカバレッジを確保
   - ユースケースはモックを用いたテストで検証
   - E2Eテストでシナリオベースの検証

3. **パフォーマンス考慮事項**
   - 集約のサイズを適切に保つ
   - 必要に応じてクエリサービスを用いた読み取り最適化
   - イベント処理の非同期化

## 現在の課題と懸念事項

1. **Value Objectの実装**
   - EmailAddressとEnrollmentStatus値オブジェクトの実装は完了
   - 残りの値オブジェクト（TeamName, ProgressStatus）の実装が必要

2. **Nominal Typing**
   - TypeScriptの構造的型システムでは、同じプロパティを持つ型が等価になってしまう
   - ブランド型や独自の型ガードを使用した名目的型付けの実装方法の検討

3. **集約サイズの考慮**
   - チーム集約が大きくなる可能性がある
   - パフォーマンスへの影響を考慮する必要がある

4. **クエリ最適化の必要性**
   - 参加者単独の情報を取得するクエリが複雑になる可能性
   - クエリサービスを活用して読み取り操作を最適化する必要がある

5. **イベント処理の信頼性**
   - イベント処理中の障害対応
   - 結果整合性（Eventually Consistent）の実現方法
   - イベントの永続化と再処理の仕組み
