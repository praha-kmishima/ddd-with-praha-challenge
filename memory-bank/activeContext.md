# アクティブコンテキスト

## 現在の開発フェーズ

現在、プロジェクトは初期段階にあります。基本的なTODOリスト機能が実装されていますが、プラハチャレンジの仕様に記載されている参加者、チーム、課題の管理機能はまだ実装されていません。

## 現在の焦点

### 実装済みの機能
- 基本的なタスク管理機能
  - タスクの作成
  - タスクのタイトル編集
  - タスクの完了状態への変更
  - タスクの取得
  - タスクリストの取得

### 現在取り組んでいる課題
- DDDの原則に基づいたドメインモデルの設計
- 4つの集約（参加者、チーム、課題、チームメンバーシップ）の実装計画
- 値オブジェクトとエンティティの適切な実装方法の検討

## 最近の変更点

### アーキテクチャの決定
- オニオンアーキテクチャの採用
- 4つの集約によるドメインモデルの設計
- ドメインイベントを用いた集約間連携の方針決定

### 技術スタックの選定
- TypeScriptとNode.jsによる実装
- Honoフレームワークを用いたAPIサーバーの構築
- DrizzleによるPostgreSQLアクセスの実装
- Vitestによるテスト環境の整備

## 次のステップ

### 短期的な目標
1. **参加者集約の実装**
   - 参加者エンティティの作成
   - EmailAddressとEnrollmentStatusの値オブジェクト実装
   - 参加者リポジトリの実装
   - 参加者関連のユースケース実装

2. **チーム集約の実装**
   - チームエンティティの作成
   - チーム名のバリデーションロジック実装
   - チームリポジトリの実装
   - チーム関連のユースケース実装

3. **課題集約の拡張**
   - 現在のタスクモデルを課題モデルに拡張
   - 進捗ステータスの値オブジェクト実装
   - 所有者との関連付け
   - 進捗ステータス変更ルールの実装

4. **チームメンバーシップ集約の実装**
   - メンバーシップエンティティの作成
   - 参加者とチームの関連付けロジック実装
   - メンバーシップリポジトリの実装
   - メンバーシップ関連のユースケース実装

### 中期的な目標
1. **ドメインサービスの実装**
   - チーム再編サービスの実装
   - 参加者管理サービスの実装
   - 課題管理サービスの実装

2. **ドメインイベントの実装**
   - イベント発行の仕組み構築
   - イベントハンドラーの実装
   - イベント永続化の検討

3. **複雑なビジネスルールの実装**
   - 参加者の増減に伴うチーム再編ロジック
   - メール通知機能の実装
   - 課題の進捗管理ロジック

## 現在のアクティブな決定事項

### 設計上の決定
1. **集約の分割方針**
   - 参加者、チーム、課題、チームメンバーシップの4つの集約に分割
   - 各集約は独自のリポジトリを持つ
   - 集約間の参照はIDのみを使用

2. **値オブジェクトの実装方針**
   - 不変性を持つクラスとして実装
   - ファクトリメソッドでバリデーションを行い、Result型で結果を返す
   - 等価性比較のためのequalsメソッドを実装

3. **リポジトリの実装方針**
   - インターフェースをドメイン層で定義
   - 実装はインフラストラクチャ層で提供
   - トランザクション管理を考慮した設計

### 技術的な決定
1. **型安全性の確保**
   - ブランド型を用いたNominal Typingの実装
   - Result型を用いたエラーハンドリング
   - Zodによる入力バリデーション

2. **テスト戦略**
   - ドメイン層は単体テストで高いカバレッジを確保
   - ユースケースはモックを用いたテストで検証
   - E2Eテストでシナリオベースの検証

3. **パフォーマンス考慮事項**
   - 集約のサイズを小さく保つ
   - 必要に応じてクエリサービスを用いた読み取り最適化
   - イベント処理の非同期化

## 現在の課題と懸念事項

1. **Value Objectの実装**
   - 現状のテンプレートではValue Objectが十分に実装されていない
   - プリミティブ型をラップした値オブジェクトの実装方法の検討

2. **Nominal Typing**
   - TypeScriptの構造的型システムでは、同じプロパティを持つ型が等価になってしまう
   - ブランド型や独自の型ガードを使用した名目的型付けの実装方法の検討

3. **集約間の整合性**
   - 集約をまたぐ操作での整合性確保
   - イベント駆動アーキテクチャの実装方法
   - 結果整合性（Eventually Consistent）の実現方法

4. **複雑なビジネスルール**
   - チーム再編ロジックの複雑さへの対応
   - 参加者の増減に伴う自動処理の実装方法
   - エッジケースの考慮と対応
