# 進捗状況

## 完了した機能

### 基本的な TODO リスト機能 ✅

- タスクエンティティ、リポジトリ、ユースケース、API エンドポイントの実装

### 開発環境の整備 ✅

- TypeScript、Vitest、Biome、Docker Compose、Drizzle の設定

### 値オブジェクトの実装 ✅

- Result 型、EmailAddress、EnrollmentStatus、TeamName、ProgressStatus の実装

### チーム集約の実装 ✅

- TeamMember エンティティ、Team エンティティ、TeamRepository の実装

### 課題集約の拡張 ✅

- Task エンティティの拡張（所有者と進捗ステータスの追加）
- タスクリポジトリの拡張（所有者による検索機能の追加）

### ドメインイベント基盤の実装 ✅

- ドメインイベントの基底クラス
- イベントバスの実装
- 単体テスト
- チーム集約のイベント実装（チーム作成、メンバー追加/削除、状態変更）
- 課題集約のイベント実装（課題作成、進捗更新）
- チームサイズ関連イベント実装（過小サイズ、過大サイズ）

### アプリケーション層のポリシー実装 ✅

- TeamReorganizationPolicy の実装
- イベントハンドラーの基本実装

### チーム再編成サービスの実装 ✅

- TeamReorganizationServiceImpl の実装
- チーム統合アルゴリズムの実装
- チーム分割アルゴリズムの実装

### 既存ユースケースの更新 ⚠️

- ✅ UpdateTaskProgressUseCaseの実装（SetTaskDoneUseCaseの置き換え）
- ❌ UpdateTaskProgressControllerの実装

## 進行中の機能

### ユースケースの更新と拡張

- ⚠️ 既存のタスク関連ユースケースの更新
  - ✅ UpdateTaskProgressUseCaseの実装
  - ❌ コントローラーの実装
- ❌ チーム関連のユースケースの実装
- ❌ 課題関連の新しいユースケースの実装

## 次に実装予定の機能

### ユースケースの更新と拡張（続き）

- ❌ チーム関連のユースケースの実装
- ❌ 課題関連の新しいユースケースの実装

### API エンドポイントの実装

- ❌ チーム関連の API エンドポイント
- ❌ 課題関連の API エンドポイント

## 既知の問題

### 設計上の問題

1. **Value Object の実装**

   - 基本的な値オブジェクトの実装パターンが確立

2. **Nominal Typing の未対応**

   - 同じプロパティを持つクラスが型的に等価になってしまう
   - ドメインの概念を型で明確に区別できていない

3. **集約間の参照方法**
   - 集約間の参照を ID で行う方針は実装済み
   - 整合性確保の仕組みが実装済み（ドメインイベントによる疎結合な連携）

### 技術的な問題

1. **エラーハンドリング**

   - Result 型を用いたエラーハンドリングの基盤は整備
   - イベントハンドラ内でのエラーハンドリングの改善が必要

2. **テストカバレッジ**

   - ドメイン層とリポジトリ層のテスト実装は完了
   - ユースケースやアプリケーション層のテストが不足

3. **パフォーマンス**

   - N+1 問題への対応が不十分
   - クエリの最適化が必要

4. **既存ユースケースの更新**

   - タスク完了状態変更ユースケースは進捗ステータス更新ユースケースに置き換える必要がある
   - UpdateTaskProgressUseCaseは実装済みだが、コントローラーの実装が必要
   - コントローラー実装の考慮点：
     - 進捗ステータスごとに個別のエンドポイントを作成（例：`/tasks/:id/in-progress`）
     - リクエスト者IDの扱いの見直し
     - 進捗ステータス文字列と値オブジェクトのマッピング改善
     - 既存のSetTaskDoneControllerとの統合

5. **既存ユースケースの最適化**
   - 既存のユースケースの効率化と改善が必要
   - エラーハンドリングの強化が必要

## 実装計画（スモールステップ）

### マイルストーン 1: 値オブジェクトの実装 ✅

- EmailAddress、EnrollmentStatus、TeamName、ProgressStatus 値オブジェクトの実装

### マイルストーン 2: チーム集約の実装 ✅

- TeamMember エンティティ、Team エンティティ、チームリポジトリの実装

### マイルストーン 3: 課題集約の拡張 ✅

- Task エンティティの拡張、タスクリポジトリの拡張

### マイルストーン 4: ドメインイベント基盤の実装 ✅

1. **フェーズ 1: ドメインイベント基盤の基本実装**
   - ドメインイベントの基底クラス
   - イベントバスの実装
   - 単体テスト
2. **フェーズ 2: チーム集約の基本イベント実装**
   - チーム作成イベント
   - メンバー追加イベント
   - Team 集約へのイベント発行機能追加
3. **フェーズ 3: 課題集約のイベント実装**
   - 課題進捗更新イベント
   - Task 集約へのイベント発行機能追加
4. **フェーズ 4: 追加のチームイベント実装**
   - メンバー削除イベント
   - メンバー状態変更イベント
   - Team 集約への追加イベント発行機能追加
5. **フェーズ 5: チームサイズ関連イベント実装**
   - チーム過小サイズイベント
   - チーム過大サイズイベント
   - Team 集約へのサイズ関連イベント発行機能追加
6. **フェーズ 6: 基本的なイベントハンドラー実装**
   - イベントハンドラーの基本実装
   - 単体テスト

### マイルストーン 5: ドメインサービスの実装 ✅

- TeamReorganizationService の実装（チーム統合・分割アルゴリズム）

### マイルストーン 6: アプリケーション層のポリシー実装 ✅

- TeamReorganizationPolicy の実装

### マイルストーン 7: ユースケースの実装 ⚠️

- ⚠️ 既存のタスク関連ユースケースの更新
  - ✅ UpdateTaskProgressUseCaseの実装
  - ❌ UpdateTaskProgressControllerの実装
- ❌ チーム関連のユースケース実装
- ❌ 課題関連の新しいユースケース実装

### マイルストーン 8: API エンドポイントの実装

- チーム関連の API エンドポイント、課題関連の API エンドポイントの実装

### マイルストーン 9: クエリ最適化とパフォーマンス改善

- クエリサービスの実装、パフォーマンス測定と改善
