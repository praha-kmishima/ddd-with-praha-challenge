# 進捗状況

## 完了した機能

### 基本的なTODOリスト機能
- ✅ タスクエンティティの実装
  - タイトルと完了状態を持つシンプルな構造
  - タイトルのバリデーション（空文字チェック、最大長チェック）
  - ULIDによるID生成

- ✅ タスクリポジトリの実装
  - インターフェース定義
  - PostgreSQL実装

- ✅ タスク関連のユースケース
  - タスク作成ユースケース
  - タスクタイトル編集ユースケース
  - タスク完了状態変更ユースケース

- ✅ タスク関連のAPIエンドポイント
  - タスク作成エンドポイント（POST /tasks/new）
  - タスク取得エンドポイント（GET /tasks/:id）
  - タスクリスト取得エンドポイント（GET /tasks）
  - タスクタイトル編集エンドポイント（PATCH /tasks/:id/title）
  - タスク完了状態変更エンドポイント（PATCH /tasks/:id/done）

### 開発環境の整備
- ✅ TypeScriptの設定
- ✅ Vitestによるテスト環境
- ✅ Biomeによるリント/フォーマット
- ✅ Docker Composeによるデータベース環境
- ✅ Drizzleによるマイグレーション管理

### ドメインモデルの設計
- ✅ 集約の再設計
  - チーム集約（参加者を子エンティティとして含む）
  - 課題集約

### 値オブジェクトの実装
- ✅ Result型の実装
  - 成功/失敗を表現する型
  - ok/errヘルパー関数
- ✅ EmailAddress値オブジェクト
  - バリデーションロジック
  - 等価性比較
  - テストケース

## 進行中の機能

### 値オブジェクトの実装
- 🔄 EnrollmentStatus値オブジェクト
  - 在籍状態の値と遷移ルールの管理
  - テストケース

## 次に実装予定の機能

### 値オブジェクトの実装
- ❌ TeamName値オブジェクト
  - チーム名のバリデーション
  - テストケース
- ❌ ProgressStatus値オブジェクト
  - 進捗状態の値と遷移ルールの管理
  - テストケース

### チーム集約の実装
- ❌ TeamMemberエンティティ（子エンティティ）
  - 参加者の基本情報管理
  - 在籍ステータスの整合性確保
  - テストケース
- ❌ Teamエンティティ（集約ルート）
  - チーム情報の管理
  - チームメンバーの管理（追加・削除）
  - チームサイズの制約適用
  - テストケース
- ❌ チームリポジトリ
  - インターフェース定義
  - PostgreSQL実装
  - テストケース

### 課題集約の拡張
- ❌ Taskエンティティの拡張
  - 所有者と進捗ステータスの追加
  - 進捗ステータス変更ロジックの実装
  - 所有者確認ロジックの実装
  - テストケース

### ドメインイベント基盤の実装
- ❌ ドメインイベントの基底クラス
- ❌ イベント発行の仕組み
- ❌ イベントハンドラーの実装
- ❌ イベント購読の仕組み

### アプリケーション層のポリシーとドメインサービスの実装
- ❌ TeamReorganizationService
  - チーム統合アルゴリズム
  - チーム分割アルゴリズム
- ❌ TeamReorganizationPolicy
- ❌ TaskManagementPolicy

### ユースケースの実装
- ❌ チーム関連のユースケース
  - チーム作成
  - チーム情報編集
  - メンバー追加
  - メンバー削除
  - メンバー状態変更
- ❌ 課題関連のユースケース
  - 課題割り当て
  - 進捗ステータス更新

### APIエンドポイントの実装
- ❌ チーム関連のAPIエンドポイント
- ❌ 課題関連のAPIエンドポイント

## 既知の問題

### 設計上の問題
1. **Value Objectの実装**
   - EmailAddress値オブジェクトの実装は完了
   - 残りの値オブジェクト（EnrollmentStatus, TeamName, ProgressStatus）の実装が必要

2. **Nominal Typingの未対応**
   - 同じプロパティを持つクラスが型的に等価になってしまう
   - ドメインの概念を型で明確に区別できていない

3. **集約間の参照方法**
   - 集約間の参照をIDで行う方針だが、実装が不十分
   - 整合性確保の仕組みが未実装

### 技術的な問題
1. **エラーハンドリング**
   - Result型を用いたエラーハンドリングの基盤は整備
   - 一部のユースケースでのみカスタムエラーを定義
   - 統一的なエラーハンドリングの仕組みが不足

2. **テストカバレッジ**
   - ドメイン層のみテスト実装
   - ユースケースやインフラストラクチャ層のテストが不足

3. **パフォーマンス**
   - N+1問題への対応が不十分
   - クエリの最適化が必要

## 実装計画（スモールステップ）

### マイルストーン1: 値オブジェクトの実装
1. **EmailAddress値オブジェクト** ✅
   - バリデーションロジック
   - 等価性比較
   - テストケース
2. **EnrollmentStatus値オブジェクト**
   - 在籍状態の値と遷移ルールの管理
   - テストケース
3. **TeamName値オブジェクト**
   - チーム名のバリデーション
   - テストケース
4. **ProgressStatus値オブジェクト**
   - 進捗状態の値と遷移ルールの管理
   - テストケース

### マイルストーン2: チーム集約の実装
1. **TeamMemberエンティティ**
   - 参加者の基本情報管理
   - 在籍ステータスの整合性確保
   - テストケース
2. **Teamエンティティ**
   - チーム情報の管理
   - チームメンバーの管理（追加・削除）
   - チームサイズの制約適用
   - テストケース
3. **チームリポジトリ**
   - インターフェース定義
   - PostgreSQL実装
   - テストケース

### マイルストーン3: 課題集約の拡張
1. **Taskエンティティの拡張**
   - 所有者と進捗ステータスの追加
   - 進捗ステータス変更ロジックの実装
   - 所有者確認ロジックの実装
   - テストケース
2. **タスクリポジトリの拡張**
   - 所有者による検索機能の追加
   - テストケース

### マイルストーン4: ドメインイベント基盤の実装
1. **ドメインイベントの基底クラス**
   - イベント基本構造の定義
   - テストケース
2. **イベント発行の仕組み**
   - イベントバスの実装
   - テストケース
3. **イベントハンドラーの実装**
   - ハンドラー登録の仕組み
   - テストケース

### マイルストーン5: ドメインサービスの実装
1. **TeamReorganizationService**
   - チーム統合アルゴリズム
   - チーム分割アルゴリズム
   - テストケース

### マイルストーン6: アプリケーション層のポリシー実装
1. **TeamReorganizationPolicy**
   - チームサイズの変更に応じた処理
   - テストケース
2. **TaskManagementPolicy**
   - 参加者の状態変更に伴う課題の処理
   - テストケース

### マイルストーン7: ユースケースの実装
1. **チーム関連のユースケース**
   - チーム作成
   - チーム情報編集
   - メンバー追加
   - メンバー削除
   - メンバー状態変更
2. **課題関連のユースケース**
   - 課題割り当て
   - 進捗ステータス更新

### マイルストーン8: APIエンドポイントの実装
1. **チーム関連のAPIエンドポイント**
   - チーム作成
   - チーム情報取得
   - チームリスト取得
   - メンバー追加
   - メンバー削除
   - メンバー状態変更
2. **課題関連のAPIエンドポイント**
   - 課題割り当て
   - 課題進捗更新
   - 課題リスト取得

### マイルストーン9: クエリ最適化とパフォーマンス改善
1. **クエリサービスの実装**
   - 読み取り操作の最適化
   - N+1問題の解決
2. **パフォーマンス測定と改善**
   - ボトルネックの特定
   - インデックスの最適化
